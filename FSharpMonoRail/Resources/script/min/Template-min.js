/**
 * Template - js Templating Class.
 * Copyright (c) 2008 Ariel Flesler - aflesler(at)gmail(dot)com | http://flesler.blogspot.com
 * Licensed under BSD (http://www.opensource.org/licenses/bsd-license.php)
 * Date: 6/5/2008
 * @author Ariel Flesler
 * @version 1.0.0
 */
;(function(){var o=1,l=2,m=3;var g=function(a,d){if(!(this instanceof g))return new g(a,d);this.source(a||'');if(typeof d=='function')this.pre=d};g.prototype={source:function(a){this.text=a;this.compiled=false},apply:function(a){this.vars=a||{};this.compile();this.pre(this.vars);return this.parse(this.tokens)},compile:function(){if(this.compiled)return;this.compiled=true;this.tokenize();this.arrange()},tokenize:function(){var k=this.tokens=[];var n=this.text.replace(g.token,function(a,d,c,f,b,h){if(d)k.push(new i(d));var j=h=='/'?m:c=='/'?l:o;k.push(new i(b,f,j));return''});if(n)k.push(new i(n))},arrange:function(){var a=this.tokens,d=-1,c,f=this.tokens=[],b=[];while(c=a[++d]){if(c.OPEN){b.push(f);f=f[f.length]=[]}f.push(c);if(c.CLOSE)f=b.pop()}while(b.length)f=b.pop()},pre:function(a){},parse:function(a){var d=-1,c='',f=[],b,h,j;while(b=a[++d]){h=g.handlers[b.type];if(b.push)b=this.parse(b);else if(b.CLOSED&&h)b=h(b,this.vars);if(b.OPEN||f.length){if(j&&b.split)f[f.length-1]+=b;else f.push(b);j=b.split}if(b.CLOSE){b=h&&h(f,this.vars)||'';f.length=0;last=null}if(!f.length)c+=b}return c}};function i(a,d,c){this.data=a;this.type=d||'text';this.OPEN=c==o;this.CLOSE=c==l;this.CLOSED=!c||c==m};i.prototype.getData=function(c){return this.type=='text'||!this.data?this.data:this.data.replace(g.variable,function(a,d){return c[d]||''})};g.token=/([^<]*?)<(\/|\?)([=-]|\w+) ?(.*?)([\/?])>/gm;g.variable=/\$\{?(\w+)\}?\b/g;g.operation=/^(.*?)([=<>!]=?)(.*)$/;g.match=function(a){if(!a)return false;a=a.match(g.operation);if(a==false)return true;try{a[0]='data=';a.push('');eval(a.join('"'))}catch(e){a=false}return a};g.handlers={'if':function(a,d){while(a.length){var c=a.shift(),f,b=typeof a[0]=='string'?a.shift():'';switch(c&&c.type){case'elseif':case'if':if(!g.match(c.getData(d)))break;default:case'else':return b}}},loop:function(a,d){var c=parseInt(a[0].getData(d),10)||0;return Array(c+1).join(a[1]||'')},text:function(a){return a.getData()},ignore:function(){return''},'-':function(a){return a[1].replace(/\n/g,'')},'=':function(a,d){return d[a.getData(d)]||''}};if(this.jQuery)jQuery.template=g;else this.Template=g})();